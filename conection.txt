sudo vi /etc/systemd/system/gunicorn.socket
[Unit]
Description=gunicorn socket

[Socket]
ListenStream=/run/gunicorn/socket

[Install]
WantedBy=sockets.target


sudo vi /etc/systemd/system/gunicorn.service

[Unit]
Description=gunicorn daemon
Requires=gunicorn.socket
After=network.target

[Service]
User=en2-user
Group=www-data
WorkingDirectory=/home/ec2-user/Documents/English-Script-Devided-App/english_script_devided_app
ExecStart=/home/ec2-user/venv/bin/gunicorn -- access-logfile - -- workers 3 --bind unix:/run/gunicorn/socket english_script_devided_app.wsgi

[Install]
WantedBy=multi-user.target

; gunicorn.service(dajngo接続)用コマンド
sudo systemctl daemon-reload
sudo systemctl restart gunicorn.service
sudo systemctl status gunicorn

# ソケット用コマンド
sudo systemctl start gunicorn.socket
sudo systemctl enable gunicorn.socket
sudo systemctl status gunicorn.socket



ubuntu = ec2-user
django = Documents
django-aws = English-Script-Devided-App
testapp = english_script_devided_app


sudo vi /etc/nginx/sites-available/English-Script-Devided-App

server {
        listen 80;
        server_name 3.83.141.134;

        location = /favicon.ico {access_log off; log_not_found off;}
        location /static/ {
                root /home/ec2-user/Documents/English-Script-Devided-App;
        }

        location / {
                # include proxy_params;
                proxy_pass http://unix:/home/ec2-user/english_script_devided_app.sock;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_redirect off;
                proxy_set_header X-Forwarded-Proto $scheme;
        }
}

sudo systemctl restart nginx
sudo systemctl status nginx

sudo tail -F /var/log/nginx/error.log

certbot certonly --webroot --agree-tos -w /home/www/letsencrypt -m keigo.work199987s@gmail.com -d  youtubelanguage.com 
 sudo ~/ec2-venv/bin/certbot  certonly --webroot --agree-tos -w ~/www/letsencrypt  -m keigo.work199987s@gmail.com -d  youtubelanguage.com
 sudo ~/ec2-venv/bin/certbot  certonly --webroot --agree-tos -w /home/www/letsencrypt  -m keigo.work199987s@gmail.com -d  youtubelanguage.com

Certificate is saved at: /etc/letsencrypt/live/youtubelanguage.com/fullchain.pem


;  DH 鍵交換用の鍵
# mkdir /etc/nginx/ssl
# cd /etc/nginx/ssl
# openssl dhparam 2048 -out dhparam.pem

; Let’s Encryptの自動更新設定
crontab -e
00 04 01 * * ~/ec2-venv/bin/certbot  renew -q --post-hook "systemctl reload nginx" > /dev/null 2>&1 


; staticファイルについて
alias /usr/share/nginx/html/static;